<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolarTrack Demo</title>
    <link rel="icon" type="image/svg+xml" href="/assets/solartrack_icon.svg">
    <link rel="stylesheet" href="./style.css">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="title-row">
                    <img src="/assets/solartrack_icon.svg" alt="SolarTrack Icon" class="header-icon">
                    <h1>SolarTrack</h1>
                </div>
                <div class="header-text">
                    <p class="subtitle">Exploring the Continuous Tracking Capabilities of Wearable Solar Harvesters</p>
                    <div class="authors">
                        <p>Yasien Ghalwash, Abdelwahed Khamis, Moid Sandhu, Sara Khalifa, Raja Jurdak</p>
                    </div>
                    <div class="header-buttons" style="display: none;">
                        <a href="#" class="header-btn" id="code-btn">
                            <i class="fab fa-github"></i>
                            Code & Dataset
                        </a>
                        <a href="#" class="header-btn" id="paper-btn">
                            <i class="fas fa-file-alt"></i>
                            Paper
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main container -->
        <div class="container">
            <!-- Control Panel -->
            <div class="control-panel">
                <div class="control-section">
                    <h3>Controls</h3>
                    
                    <div class="control-group">
                        <label for="gesture-select">Trajectory:</label>
                        <select id="gesture-select">
                            <option value="Circle">Circle</option>
                            <option value="One">One</option>
                            <option value="Two">Two</option>
                            <option value="Three">Three</option>
                            <option value="Triangle">Triangle</option>
                            <option value="Custom">Custom (Draw Your Own)</option>
                        </select>
                    </div>

                    <div class="control-group csv-upload-group">
                        <label>Upload Motion Data:</label>
                        <button id="upload-csv-btn" class="btn btn-upload">
                            <i class="fas fa-file-csv"></i> Upload Motion Capture
                        </button>
                        <input type="file" id="csv-input" accept=".csv" style="display: none;">
                        <div id="upload-progress-container" class="progress-container" style="display: none;">
                            <div id="upload-progress-bar" class="upload-progress-bar"></div>
                            <span id="upload-progress-text" class="upload-progress-text">0%</span>
                        </div>
                        <div id="upload-status" class="status-message" style="display: none;"></div>
                        <div class="upload-notice">
                            ‚ÑπÔ∏è Your CSV file is processed entirely in your browser. No data is uploaded to our servers.
                        </div>
                    </div>

                    <div class="control-group">
                        <label>
                            Radiometric Model: 
                            <span class="info-icon" data-tooltip="model-info">‚ìò</span>
                        </label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="model" value="oriented" id="model-oriented" checked>
                                <span>Orientation Aware</span>
                            </label>
                            <label>
                                <input type="radio" name="model" value="parallel" id="model-parallel">
                                <span>Parallel Disk</span>
                            </label>
                        </div>
                        
                        <!-- Tooltip -->
                        <div id="model-info-tooltip" class="tooltip-content" style="display: none;">
                            <strong>Orientation Aware:</strong> Accounts for hand orientation using Lambert's cosine law. Power depends on the angle between the cell normal and light direction (P ‚àù cos Œ∏).
                            <br><br>
                            <strong>Parallel Disk:</strong> Simplified model assuming the palm normal always points upward, ignoring orientation effects.
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Light Position:</label>
                        <div class="slider-group">
                            <label>X (mm): <span id="light-x-value">-159.8</span></label>
                            <input type="range" id="light-x" min="-500" max="500" value="-159.81" step="1">
                        </div>
                        <div class="slider-group">
                            <label>Y (mm): <span id="light-y-value">868.8</span></label>
                            <input type="range" id="light-y" min="500" max="1200" value="868.82" step="1">
                        </div>
                        <div class="slider-group">
                            <label>Z (mm): <span id="light-z-value">168.2</span></label>
                            <input type="range" id="light-z" min="-500" max="500" value="168.23" step="1">
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Animation:</label>
                        <div class="button-group">
                            <button id="play-btn" class="btn btn-primary">‚ñ∂ Play</button>
                            <button id="pause-btn" class="btn btn-secondary" disabled>‚è∏ Pause</button>
                            <button id="reset-btn" class="btn btn-secondary">‚èÆ Reset</button>
                        </div>
                        <div class="slider-group">
                            <label>Speed: <span id="speed-value">1.0</span>x</label>
                            <input type="range" id="speed" min="0.5" max="3" value="1" step="0.5">
                        </div>
                        <div class="progress-container">
                            <div id="progress-bar" class="progress-bar"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Visualization Area -->
            <div class="viz-container">
                <!-- 3D Scene and Equation Box Row -->
                <div class="top-row">
                    <!-- 3D Scene with state overlay -->
                    <div class="scene-wrapper">
                        <div id="scene-container" class="scene-container"></div>
                        
                        <!-- Mobile-only floating controls -->
                        <div class="mobile-controls">
                            <!-- Top-left: Trajectory selector -->
                            <div class="mobile-control mobile-trajectory">
                                <select id="mobile-gesture-select">
                                    <option value="Circle">Circle</option>
                                    <option value="One">One</option>
                                    <option value="Two">Two</option>
                                    <option value="Three">Three</option>
                                    <option value="Triangle">Triangle</option>
                                    <option value="Custom">Custom</option>
                                </select>
                            </div>
                            
                            <!-- Top-right: Model selector -->
                            <div class="mobile-control mobile-model">
                                <button class="model-btn active" data-model="oriented" title="Orientation Aware">üìê</button>
                                <button class="model-btn" data-model="parallel" title="Parallel Disk">‚ä•</button>
                            </div>
                            
                            <!-- Bottom-center: Animation controls -->
                            <div class="mobile-control mobile-animation">
                                <button class="anim-btn" id="mobile-play-btn" title="Play">‚ñ∂</button>
                                <button class="anim-btn" id="mobile-pause-btn" title="Pause" disabled>‚è∏</button>
                                <button class="anim-btn" id="mobile-reset-btn" title="Reset">‚èÆ</button>
                            </div>
                            
                            <!-- Light position arrows -->
                            <div class="mobile-control mobile-light-arrows">
                                <div class="arrow-group">
                                    <button class="arrow-btn arrow-up" data-axis="y" data-dir="1" title="Move Light Up">‚Üë</button>
                                    <div class="arrow-row">
                                        <button class="arrow-btn arrow-left" data-axis="x" data-dir="-1" title="Move Light Left">‚Üê</button>
                                        <div class="arrow-center">üí°</div>
                                        <button class="arrow-btn arrow-right" data-axis="x" data-dir="1" title="Move Light Right">‚Üí</button>
                                    </div>
                                    <button class="arrow-btn arrow-down" data-axis="y" data-dir="-1" title="Move Light Down">‚Üì</button>
                                </div>
                                <div class="arrow-z">
                                    <button class="arrow-btn arrow-forward" data-axis="z" data-dir="1" title="Move Light Forward">‚ñ≤</button>
                                    <button class="arrow-btn arrow-back" data-axis="z" data-dir="-1" title="Move Light Back">‚ñº</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Drawing Canvas Overlay (hidden by default) -->
                        <div id="drawing-overlay" class="drawing-overlay" style="display: none;">
                            <div class="drawing-instructions">
                                <h3>Draw Your Trajectory</h3>
                                <p>Click and drag to draw a path with your mouse</p>
                                <p class="drawing-hint">üí° Tip: Draw upward ‚Üë to approach the light</p>
                            </div>
                            <canvas id="drawing-canvas"></canvas>
                            <div class="drawing-controls">
                                <button id="drawing-done-btn" class="btn btn-primary">‚úì Done</button>
                                <button id="drawing-clear-btn" class="btn btn-secondary">‚Üª Clear</button>
                                <button id="drawing-cancel-btn" class="btn btn-secondary">‚úï Cancel</button>
                            </div>
                        </div>
                        
                        <!-- Current State Display (overlay on 3D scene) -->
                        <div class="state-display-overlay">
                            <h3>
                                Current State
                                <span class="info-icon" data-tooltip="current-state">‚ìò</span>
                            </h3>
                            <div class="state-values">
                                <div class="state-item">
                                    <span class="state-label">a =</span>
                                    <span id="state-a" class="state-value">0.0</span>
                                    <span class="state-unit">mm</span>
                                </div>
                                <div class="state-item">
                                    <span class="state-label">H =</span>
                                    <span id="state-h" class="state-value">0.0</span>
                                    <span class="state-unit">mm</span>
                                </div>
                                <div class="state-item" id="theta-state-item">
                                    <span class="state-label">Œ∏ =</span>
                                    <span id="state-theta" class="state-value">0.0</span>
                                    <span class="state-unit">¬∞</span>
                                </div>
                                <div class="state-item">
                                    <span class="state-label">Power =</span>
                                    <span id="state-power" class="state-value">0.0</span>
                                    <span class="state-unit">ŒºW</span>
                                </div>
                                <div class="state-item" id="kappa-state-item" style="display: none;">
                                    <span class="state-label">Œ∫ =</span>
                                    <span id="state-kappa" class="state-value">0.0</span>
                                    <button id="kappa-edit-btn" class="kappa-edit-btn" title="Configure Œ∫">
                                        <i class="fas fa-cog"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Tooltip -->
                            <div id="current-state-tooltip" class="tooltip-content" style="display: none;">
                                <strong>a:</strong> Lateral offset - horizontal distance between hand and light source in the XZ plane (mm).
                                <br><br>
                                <strong>H:</strong> Height - vertical separation between hand and light source (mm).
                                <br><br>
                                <strong>Œ∏:</strong> Incidence angle - angle between the solar cell normal and the light direction vector (degrees). Smaller angles mean more direct light.
                                <br><br>
                                <strong>Power:</strong> Current simulated power received by the solar cell (ŒºW).
                            </div>
                        </div>
                    </div>
                    
                    <!-- Background Box -->
                    <div class="equation-box">
                        <h3>Background</h3>
                        <div class="background-description">
                            <p>This demo visualizes power harvesting from wearable solar cells moving under a light source without occlusion. Using our efficient radiometric model (detailed in the paper), we enable continuous hand tracking and motion monitoring for wearable devices, with potential for other applications.</p>
                        </div>
                        <div class="equation">
                            \[P = \kappa \cdot \mathcal{F}(a, H) + \epsilon\]
                        </div>
                        <div class="equation-description">
                            <p>The harvested power \(P\) is a smooth, deterministic function of the cell's lateral displacement \(a\) and vertical separation \(H\) (‚àÄ \(H > 0\)), scaled by a constant \(\kappa\) that captures solar cell and light source properties. \(\epsilon\) accounts for noise.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Power Chart -->
                <div class="chart-container">
                    <canvas id="power-chart"></canvas>
                    <button id="reset-zoom-btn" class="btn-reset-zoom-overlay" title="Reset Zoom">
                        <i class="fas fa-expand"></i>
                    </button>
                    <button id="export-csv-btn" class="btn-export-overlay" title="Export Power Trace as CSV">
                        <i class="fas fa-download"></i>
                    </button>
                    <div class="metrics">
                        <span id="metric-rmse">RMSE: 0.0 ŒºW</span>
                        <span id="metric-r2">R¬≤: 0.000</span>
                        <span id="metric-corr">œÅ: 0.000</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kappa Configuration Modal -->
    <div id="kappa-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Configure Scaling Factor (Œ∫)</h3>
                <button class="modal-close" id="kappa-modal-close">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="kappa-info">
                    <p><strong>Current Œ∫:</strong> <span id="modal-current-kappa">0.0</span></p>
                    <p><strong>Source:</strong> <span id="modal-kappa-source">N/A</span></p>
                    <p class="kappa-note">Œ∫ is a constant for a given solar cell and light source setup.</p>
                </div>
                
                <div class="kappa-options">
                    <div class="radio-option">
                        <input type="radio" id="kappa-use-calculated" name="kappa-method" value="calculated" checked>
                        <label for="kappa-use-calculated">
                            <strong>Use Calculated Œ∫ (from Real Data)</strong>
                            <span class="option-desc">Least-squares fit minimizes error between real and simulated power</span>
                        </label>
                        <div class="calculated-info" id="calculated-kappa-info">
                            <p>Calculated Œ∫: <span id="calculated-kappa-value">0.0</span></p>
                            <p>RMSE: <span id="calculated-rmse-value">0.0</span> ŒºW</p>
                        </div>
                    </div>
                    
                    <div class="radio-option">
                        <input type="radio" id="kappa-manual" name="kappa-method" value="manual">
                        <label for="kappa-manual">
                            <strong>Manual Input</strong>
                            <span class="option-desc">Enter custom Œ∫ value (e.g., from calibration)</span>
                        </label>
                        <div class="manual-input-group" id="manual-kappa-group" style="display: none;">
                            <input type="text" id="manual-kappa-input" placeholder="e.g., 2.45e-4">
                            <span class="input-hint">Use scientific notation (e.g., 2.45e-4)</span>
                        </div>
                    </div>
                    
                    <div class="radio-option">
                        <input type="radio" id="kappa-physics" name="kappa-method" value="physics">
                        <label for="kappa-physics">
                            <strong>Calculate from Physical Parameters</strong>
                            <span class="option-desc">Enter cell and light source properties</span>
                        </label>
                        <div class="physics-input-group" id="physics-kappa-group" style="display: none;">
                            <div class="input-row">
                                <label>Solar cell efficiency (%):</label>
                                <input type="number" id="physics-efficiency" value="15" min="0" max="100" step="0.1">
                            </div>
                            <div class="input-row">
                                <label>Cell area (cm¬≤):</label>
                                <input type="number" id="physics-area" value="25" min="0" step="0.1">
                            </div>
                            <div class="input-row">
                                <label>Light source power (W):</label>
                                <input type="number" id="physics-power" value="100" min="0" step="1">
                            </div>
                            <p class="calculated-result">Calculated Œ∫: <span id="physics-kappa-result">0.0</span></p>
                            <button type="button" id="calculate-physics-btn" class="btn btn-secondary">Calculate</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" id="kappa-cancel-btn">Cancel</button>
                <button class="btn btn-primary" id="kappa-apply-btn">Apply & Update</button>
            </div>
        </div>
    </div>

    <script type="module" src="/main.js"></script>
</body>
</html>

