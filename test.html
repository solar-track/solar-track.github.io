<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolarTrack - Testing Guide</title>
    <link rel="stylesheet" href="/help.css">
    <!-- KaTeX for equations -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, {
            delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false}
            ]
        });"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="help-container">
        <!-- Header -->
        <header class="help-header">
            <div class="header-left">
                <img src="/assets/solartrack_icon.svg" alt="SolarTrack" class="help-logo">
                <h1>Testing Guide</h1>
            </div>
            <div class="header-right">
                <a href="help.html" class="back-btn">
                    <i class="fas fa-book"></i>
                    Documentation
                </a>
            </div>
        </header>

        <div class="help-content">
            <!-- Navigation Sidebar -->
            <nav class="help-nav">
                <ul>
                    <li><a href="#quick-validation" class="nav-link active"><i class="fas fa-bolt"></i> Quick Validation</a></li>
                    <li><a href="#model-test" class="nav-link"><i class="fas fa-balance-scale"></i> Model Comparison</a></li>
                    <li><a href="#automated-tests" class="nav-link"><i class="fas fa-robot"></i> Automated Tests</a></li>
                </ul>
            </nav>

            <!-- Main Content -->
            <main class="help-main">
                <!-- Overview -->
                <section id="overview" class="help-section">
                    <h2><i class="fas fa-clipboard-check"></i> Overview</h2>
                    
                    <p class="lead">
                        This guide helps you verify that the SolarTrack Radiometric Simulator is working correctly.
                    </p>
                </section>

                <!-- Quick Validation -->
                <section id="quick-validation" class="help-section">
                    <h2><i class="fas fa-bolt"></i> Quick Validation (2 minutes)</h2>
                    
                    <p>Perform these checks to verify basic functionality:</p>

                    <div class="steps">
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Start the Simulator</h4>
                                <div class="code-block">
                                    <code>npm install && npm run dev</code>
                                </div>
                                <p>Open <strong>http://localhost:3000</strong> in your browser.</p>
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Verify Initial State</h4>
                                <ul class="checklist">
                                    <li><i class="fas fa-check-circle"></i> Circle trajectory visible in 3D view</li>
                                    <li><i class="fas fa-check-circle"></i> Light source (yellow disk) visible above trajectory</li>
                                    <li><i class="fas fa-check-circle"></i> Power chart shows two curves: Real (brown) and Simulated (orange)</li>
                                    <li><i class="fas fa-check-circle"></i> Metrics displayed: RMSE, RÂ², Ï</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Test Animation</h4>
                                <p>Click <strong>â–¶ Play</strong> button.</p>
                                <ul class="checklist">
                                    <li><i class="fas fa-check-circle"></i> Hand icon moves along the trajectory</li>
                                    <li><i class="fas fa-check-circle"></i> Red dashed line in chart follows playback position</li>
                                    <li><i class="fas fa-check-circle"></i> Current State panel updates (a, H, Î¸, Power values change)</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Test Light Position</h4>
                                <p>Adjust the <strong>Y (mm)</strong> slider in the Controls panel.</p>
                                <ul class="checklist">
                                    <li><i class="fas fa-check-circle"></i> Light source moves in 3D view</li>
                                    <li><i class="fas fa-check-circle"></i> Simulated power curve updates immediately</li>
                                    <li><i class="fas fa-check-circle"></i> RMSE value changes</li>
                                </ul>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <h4>Test CSV Upload</h4>
                                <p>Click <strong>Upload Motion Capture</strong> and select a CSV file.</p>
                                <ul class="checklist">
                                    <li><i class="fas fa-check-circle"></i> Trajectory updates in 3D view</li>
                                    <li><i class="fas fa-check-circle"></i> Power chart recalculates with new data</li>
                                    <li><i class="fas fa-check-circle"></i> Status message shows sample count</li>
                                </ul>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step-number">6</div>
                            <div class="step-content">
                                <h4>Test Export</h4>
                                <p>Click the <strong>Download</strong> button (bottom-right of chart).</p>
                                <ul class="checklist">
                                    <li><i class="fas fa-check-circle"></i> CSV file downloads</li>
                                    <li><i class="fas fa-check-circle"></i> File contains timestamp, simulated_power_W, a_mm, H_mm columns</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Model Comparison Test -->
                <section id="model-test" class="help-section">
                    <h2><i class="fas fa-balance-scale"></i> Model Comparison Test</h2>
                    
                    <p>
                        This test validates the difference between the <strong>Parallel Disk</strong> and 
                        <strong>Orientation Aware</strong> radiometric models.
                    </p>

                    <div class="info-box">
                        <h4><i class="fas fa-lightbulb"></i> Notable Test Case: Triangle Trajectory</h4>
                        <p>
                            The <strong>Triangle</strong> trajectory shows a notable difference between models 
                            because the hand tilts considerably during the motion. 
                            See <a href="help.html#model-comparison-screenshot">model comparison in documentation</a>.
                        </p>
                    </div>

                    <h3>Test Steps</h3>
                    <ol>
                        <li>Select <strong>Triangle</strong> from the Trajectory dropdown</li>
                        <li>Ensure <strong>Orientation Aware</strong> model is selected</li>
                        <li>Observe the power curve around the peak â€” note the nuanced shape that closely follows the real power</li>
                        <li>Switch to <strong>Parallel Disk</strong> model</li>
                        <li>Observe that the curve around the peak is now <strong>smoother</strong> and less accurate</li>
                    </ol>

                    <h3>Expected Behavior</h3>
                    <p>
                        The <strong>Orientation Aware</strong> model produces a more nuanced power curve that follows 
                        the real measurements more closely, especially around peaks where hand tilt is significant. 
                        The <strong>Parallel Disk</strong> model produces a smoother curve that misses tilt-induced 
                        variations, resulting in higher RMSE and lower RÂ².
                    </p>
                </section>

                <!-- Automated Tests -->
                <section id="automated-tests" class="help-section">
                    <h2><i class="fas fa-robot"></i> Automated Tests</h2>
                    
                    <p class="lead">
                        Run the automated test suite to verify that the radiometric models produce 
                        consistent results against precomputed expected outputs.
                    </p>

                    <h3>Test Data</h3>
                    <p>
                        The tests use 5 trajectory CSVs in <code>tests/data/</code>, derived from the 
                        motion capture recordings used in the paper. Each contains position, normal vectors, 
                        and measured power from a wearable solar cell.
                    </p>
                    <table class="help-table">
                        <thead>
                            <tr><th>File</th><th>Samples</th><th>Description</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><code>Circle__Synchronized.csv</code></td><td>2667</td><td>Circular hand motion</td></tr>
                            <tr><td><code>One__Synchronized.csv</code></td><td>1797</td><td>Drawing "1" gesture</td></tr>
                            <tr><td><code>Three__Synchronized.csv</code></td><td>4051</td><td>Drawing "3" gesture</td></tr>
                            <tr><td><code>Triangle__Synchronized.csv</code></td><td>2753</td><td>Triangular motion with tilt</td></tr>
                            <tr><td><code>Two__Synchronized.csv</code></td><td>3379</td><td>Drawing "2" gesture</td></tr>
                        </tbody>
                    </table>

                    <h3>Validation Metrics</h3>
                    <table class="help-table">
                        <thead>
                            <tr><th>Metric</th><th>Definition</th><th>Pass Tolerance</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>RMSE</strong></td>
                                <td>Root Mean Square Error between simulated and real power (in ÂµW)</td>
                                <td>Â±1 ÂµW</td>
                            </tr>
                            <tr>
                                <td><strong>RÂ²</strong></td>
                                <td>Coefficient of determination â€” how much variance in real power is explained by the model (1 = perfect fit)</td>
                                <td>Â±0.001</td>
                            </tr>
                            <tr>
                                <td><strong>Ï (rho)</strong></td>
                                <td>Pearson correlation â€” linear relationship between simulated and real power (1 = perfect correlation)</td>
                                <td>Â±0.001</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="note">
                        <i class="fas fa-info-circle"></i>
                        A test passes if all three metrics match the precomputed expected values within their tolerances.
                    </p>

                    <h3>Run Automated Tests</h3>
                    <div class="code-block">
                        <code>npm test</code>
                    </div>

                    <h3>Example Output</h3>
                    <div class="code-block" style="font-size: 0.8rem; overflow-x: auto;">
                        <pre>Validation Process:
  1. Load trajectory CSV (position + normal vectors)
  2. Compute view factor using specified radiometric model
  3. Calculate Îº (kappa) via least-squares: P_real = Îº Ã— F(a,H)
  4. Compute metrics: RMSE, RÂ², Pearson correlation (Ï)
  5. Compare against precomputed expected values

Tolerance thresholds:
  RMSE: Â±1 ÂµW | RÂ²: Â±0.001 | Ï: Â±0.001

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“ Circle (2667 samples)

   â”Œâ”€ Parallel Disk (Eq. A.5)
   â”‚  Light: (-160, 869, 168) mm, Diameter: 100mm
   â”‚  Îº = 2.883e-3 (computed via least-squares)
   â”‚
   â”‚  Computed metrics:
   â”‚    RMSE = 44.85 ÂµW
   â”‚    RÂ²   = 0.4150
   â”‚    Ï    = 0.7595
   â”‚
   â”‚  Expected vs Actual (tolerance):
   â”‚    RMSE: 44.85 vs 44.85 ÂµW  Î”=0.000 âœ“
   â”‚    RÂ²:   0.4150 vs 0.4150  Î”=0.00000 âœ“
   â”‚    Ï:    0.7595 vs 0.7595  Î”=0.00000 âœ“
   â””â”€ âœ… PASS

... (19 more test cases) ...

ğŸ“Š SUMMARY
   Total tests:  20
   Passed:       20 âœ…
   Failed:       0 âŒ

ğŸ‰ All tests passed!</pre>
                    </div>

                    <h3>Test Data Structure</h3>
                    <table class="help-table">
                        <thead>
                            <tr>
                                <th>Path</th>
                                <th>Contents</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>tests/data/</code></td>
                                <td>Input CSV files (motion capture trajectories)</td>
                            </tr>
                            <tr>
                                <td><code>tests/expected/</code></td>
                                <td>Precomputed expected outputs per model</td>
                            </tr>
                            <tr>
                                <td><code>tests/expected_metrics.json</code></td>
                                <td>Summary of expected RMSE, RÂ², Ï values</td>
                            </tr>
                            <tr>
                                <td><code>tests/validate.js</code></td>
                                <td>Validation script (compares actual vs expected)</td>
                            </tr>
                            <tr>
                                <td><code>tests/generate_expected.js</code></td>
                                <td>Script to regenerate expected outputs</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Regenerate Expected Outputs</h3>
                    <p>If you modify the model implementation, regenerate expected outputs:</p>
                    <div class="code-block">
                        <code>npm run test:generate</code>
                    </div>
                    <p class="note">
                        <i class="fas fa-exclamation-triangle"></i>
                        Only regenerate if you intentionally changed the model behavior.
                    </p>
                </section>
            </main>
        </div>

        <!-- Footer -->
        <footer class="help-footer">
            <p>SolarTrack Radiometric Simulator â€” Testing Guide</p>
        </footer>
    </div>

    <!-- Smooth scrolling and active nav highlighting -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('.help-section');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            });
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.getAttribute('id');
                        navLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === '#' + id) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            }, { threshold: 0.2, rootMargin: '-100px 0px -50% 0px' });
            
            sections.forEach(section => observer.observe(section));
        });
    </script>
</body>
</html>
